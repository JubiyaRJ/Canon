#!/usr/bin/env node

var http = require('http'),
	Compendium = require('../lib/'),
	compendium = new Compendium(),
	server = require('../lib/server'),
	routes = require('../routes'),
	middleware = require('../middleware'),
	app;

// work out the port
var port = 8111;

compendium.scanDirectories(function (err, catalog) {

	app = server.server(port, catalog, compendium.toHTML());

	// create a catch-all route
	app.app.get('*', middleware.find(compendium, app.app), routes.find);

	http.createServer(app.app).listen(port, function () {

		console.log('Your wiki has been started and running at http://localhost:%s', port);

	});

});